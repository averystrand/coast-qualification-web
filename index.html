<script>
  async function lookupQualification() {
    const domain = document.getElementById("domain").value.trim();
    const resultBox = document.getElementById("result");
    resultBox.textContent = "Looking up...";

    if (!domain) {
      resultBox.textContent = "Please enter a domain.";
      return;
    }

    try {
      await fetch("https://linkedin-email-finder-proxy.vercel.app/api/submitQualification", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ Domain: domain })
      });

      resultBox.textContent = "Waiting for enrichment…";

      let data = null;
      let attempts = 0;

      while (!data && attempts < 20) {
        attempts++;
        await new Promise(r => setTimeout(r, 3000));

        const res = await fetch(`https://linkedin-email-finder-proxy.vercel.app/api/notifyQualification?domain=${encodeURIComponent(domain)}`);
        data = await res.json();
      }

      if (data?.normalized) {
        const n = data.normalized;
        resultBox.innerHTML = `
          Industry: ${n.Industry || "—"}<br>
          Employee Count: ${n.Employee_Count || "—"}<br>
          Swagger/Soap/Postman/OpenAPI: ${n.Swagger_Soap_Postman_OpenAPI || "—"}<br>
          Gateways: ${n.Gateways || "—"}<br>
          API URL: ${n.API_URL || "—"}<br>
          API/SDK Presence: ${n.API_SDK_Presence || "—"}
        `;
      } else {
        resultBox.textContent = "No qualification data found.";
      }
    } catch (err) {
      resultBox.textContent = "Error: " + err.message;
    }
  }
</script>
